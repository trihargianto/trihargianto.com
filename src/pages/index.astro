---
import { getCollection } from "astro:content";
import dayjs from "dayjs";

import BaseLayout from "../layouts/BaseLayout.astro";

import GreetingCard from "../components/GreetingCard.astro";
import LatestArticlesGrid from "../components/LatestArticlesGrid.astro";
import SkillsSection from "../components/SkillsSection.astro";
// import LatestProject from "../components/LatestProject.astro";

import { publications } from "../content/publications";

const allBlogPosts = await getCollection("blog");
const allProjects = await getCollection("project");

const latestArticles = allBlogPosts
  // Sort by `pubDate` in descending order
  .sort((a, b) => {
    return dayjs(b.data.pubDate).valueOf() - dayjs(a.data.pubDate).valueOf();
  })
  // Limit to 6 latest articles for grid layout (2 rows x 3 columns)
  .slice(0, 6)
  .map((post) => ({
    title: post.data.title,
    date: dayjs(post.data.pubDate).format("MMM YYYY"),
    slug: post.id,
    tags: post.data.tags,
    featuredImage: post.data.featured?.src,
    description: post.data.description,
  }));

const LIMIT_LATEST_PUBLICATIONS = 6;

const latestPublications = publications.slice(0, LIMIT_LATEST_PUBLICATIONS).map((pub) => ({
  title: pub.title,
  date: pub.date,
  link: pub.link,
  platform: pub.platform,
}));

const latestProjects = allProjects.map((project) => ({
  title: project.data.title,
  slug: project.id,
  description: project.data.description,
  category: project.data.category,
  demoLink: project.data.demoLink,
  githubLink: project.data.githubLink,
  tags: project.data.tags,
}));
---

<BaseLayout
  pageTitle="trihargianto.com - A personal digital garden by Tri Hargianto"
>
  <GreetingCard />

  <div class="mt-14">
    <SkillsSection clientDirective="visible" />
  </div>

  <LatestArticlesGrid
    sectionTitle="Latest Articles"
    articles={latestArticles}
    className="mt-14"
    seeAllLink="/blog/"
    columns="3"
  />

  <LatestArticlesGrid
    sectionTitle="Publications"
    articles={latestPublications}
    className="mt-14"
    seeAllLink="/publications/"
    columns="3"
  />

  <!-- <LatestProject -->
  <!--   projects={latestProjects} -->
  <!--   className="mt-14" -->
  <!--   seeAllLink="/pet-projects/" -->
  <!-- /> -->
</BaseLayout>
