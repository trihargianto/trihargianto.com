---
import { getRelatedPosts } from "../utils/relatedPosts";
import dayjs from "dayjs";
import { Image } from "astro:assets";

type Props = {
  currentSlug: string;
  currentTags?: string[];
};

const { currentSlug, currentTags = [] } = Astro.props;

const relatedPosts = await getRelatedPosts(currentSlug, currentTags, 4);
---

{
  relatedPosts.length > 0 && (
    <aside class="mt-16 rounded-3xl border border-slate-200/70 bg-white/90 px-6 py-8 shadow-xl dark:border-slate-800/70 dark:bg-slate-900/80">
      <div class="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
        <h2 class="text-2xl font-semibold text-slate-900 dark:text-white">
          Keep exploring
        </h2>
        <span class="text-sm font-medium text-slate-500 dark:text-slate-400">
          Curated for you based on topics you just read
        </span>
      </div>
      <div class="mt-6 grid gap-6 lg:grid-cols-2">
        {relatedPosts.map((post) => (
          <a
            href={`/blog/${post.data.slug}`}
            class="group relative overflow-hidden rounded-3xl border border-slate-200/70 bg-white/95 p-5 shadow-lg transition hover:-translate-y-1 hover:border-sky-200 hover:shadow-2xl dark:border-slate-800/70 dark:bg-slate-900/90"
            aria-label={`Read related article ${post.data.title}`}
          >
            {post.data.featured && (
              <div class="pointer-events-none absolute inset-0 opacity-25 transition group-hover:opacity-35">
                <Image
                  src={post.data.featured}
                  alt={post.data.title}
                  widths={[360, 560]}
                  sizes="(max-width: 768px) 100vw, 45vw"
                  class="h-full w-full object-cover"
                  loading="lazy"
                />
                <div class="absolute inset-0 bg-gradient-to-br from-white via-white/75 to-transparent dark:from-slate-900 dark:via-slate-900/80" />
              </div>
            )}
            <div class="relative z-10 flex flex-col gap-3">
              <span class="inline-flex w-fit items-center gap-2 rounded-full bg-slate-100 px-3 py-1 text-xs font-semibold uppercase tracking-widest text-slate-500 dark:bg-slate-800/70 dark:text-slate-300">
                {post.data.category ?? "Fresh insight"}
              </span>
              <h3 class="text-lg font-semibold text-slate-900 transition group-hover:text-sky-600 dark:text-white dark:group-hover:text-sky-300">
                {post.data.title}
              </h3>
              <p class="text-sm text-slate-600 line-clamp-3 dark:text-slate-300">
                {post.data.description}
              </p>
              <div class="flex items-center justify-between text-xs font-medium text-slate-500 dark:text-slate-400">
                <time datetime={post.data.pubDate.toISOString()}>
                  {dayjs(post.data.pubDate).format("MMM DD, YYYY")}
                </time>
                <span class="inline-flex items-center gap-1 text-sky-600 dark:text-sky-300">
                  Read more <span aria-hidden>â†—</span>
                </span>
              </div>
            </div>
          </a>
        ))}
      </div>
    </aside>
  )
}
