---
/**
 * Analytics component supporting Google Analytics, Plausible, and Umami.
 * Configured via environment variables:
 * - GOOGLE_ANALYTICS_ID (GA4 measurement ID)
 * - PLAUSIBLE_DOMAIN (your domain for Plausible)
 * - UMAMI_WEBSITE_ID (Umami website ID)
 * - UMAMI_SRC (Umami script URL, defaults to https://analytics.umami.is/script.js)
 *
 * Only loads in production (import.meta.env.PROD).
 */

const GOOGLE_ANALYTICS_ID = import.meta.env.GOOGLE_ANALYTICS_ID || "G-0YX3YD7TKV";
const PLAUSIBLE_DOMAIN = import.meta.env.PLAUSIBLE_DOMAIN;
const UMAMI_WEBSITE_ID = import.meta.env.UMAMI_WEBSITE_ID;
const UMAMI_SRC =
  import.meta.env.UMAMI_SRC || "https://analytics.umami.is/script.js";

const isProduction = import.meta.env.PROD;
---

{
  isProduction && (
    <>
      {/* Google Analytics */}
      {GOOGLE_ANALYTICS_ID && (
        <>
          <link rel="preconnect" href="https://www.google-analytics.com" />
          <script
            async
            is:inline
            src={`https://www.googletagmanager.com/gtag/js?id=${GOOGLE_ANALYTICS_ID}`}
          />
          <script is:inline define:vars={{ GOOGLE_ANALYTICS_ID }}>
            window.dataLayer = window.dataLayer || [];
            function gtag() {
              dataLayer.push(arguments);
            }
            gtag("js", new Date());
            gtag("config", GOOGLE_ANALYTICS_ID);
          </script>
        </>
      )}

      {/* Plausible Analytics */}
      {PLAUSIBLE_DOMAIN && (
        <script
          defer
          data-domain={PLAUSIBLE_DOMAIN}
          src="https://plausible.io/js/script.js"
        />
      )}

      {/* Umami Analytics */}
      {UMAMI_WEBSITE_ID && (
        <script
          defer
          src={UMAMI_SRC}
          data-website-id={UMAMI_WEBSITE_ID}
        />
      )}
    </>
  )
}
