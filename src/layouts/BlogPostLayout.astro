---
import "../styles/global.css";

import type { CollectionEntry } from "astro:content";
import { Image } from "astro:assets";
import dayjs from "dayjs";
import { kebabCase } from "lodash-es";

import { SOCIAL_TWITTER, SITE_URL } from "../constants/config";
import SocialShareButtons from "../components/SocialShareButtons";
import BlogComments from "../components/BlogComments";
import ButtonScrollTop from "../components/ButtonScrollTop";
import BaseLayout from "./BaseLayout.astro";

type Props = CollectionEntry<"blog">["data"];

const {
  slug,
  title,
  description,
  pubDate,
  featured,
  featuredSource,
  featuredSourceUrl,
} = Astro.props;

const date = dayjs(pubDate).format("MMM YYYY");
---

<BaseLayout
  pageTitle={`${title} | Tri Hargianto`}
  pageDescription={description}
>
  <ButtonScrollTop client:idle />

  <p class="mb-2 text-sm text-gray-700 dark:text-gray-500">
    <span>üóìÔ∏è {date}</span>
  </p>

  <h1 class="mb-3!" style={{ viewTransitionName: kebabCase(title) }}>
    {title}
  </h1>

  <p class="mb-4 text-sm! text-gray-700 dark:text-gray-500 sm:text-base">
    {description}
  </p>

  <Image src={featured} alt={title} class="w-full" />

  {
    featuredSource && featuredSourceUrl ? (
      <p class="w-full text-xs mt-1 text-center">
        Original Photo by
        <a
          href={featuredSourceUrl}
          target="_blank"
          rel="noopener"
          class="underline"
        >
          {featuredSource}
        </a>
      </p>
    ) : null
  }

  <section class="max-w-none prose dark:prose-invert mt-8">
    <slot />
  </section>

  <div class="container mx-auto">
    <hr class="my-8" />

    <SocialShareButtons
      socialConfig={{
        twitter: SOCIAL_TWITTER,
        config: {
          url: `${SITE_URL}${slug}`,
          title,
          description,
        },
      }}
      client:idle
    />

    <p class="mb-6 text-left text-2xl font-semibold md:text-center">Comments</p>

    <BlogComments client:idle />
  </div>
</BaseLayout>
